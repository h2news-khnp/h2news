<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KHNP H2 뉴스 아카이브</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background: #f7f7f7;
            font-family: "Pretendard", sans-serif;
        }

        header {
            background: #0054A6;
            color: white;
            padding: 1.5rem 0;
            margin-bottom: 2rem;
            text-align: center;
        }

        .news-card {
            background: white;
            border-radius: 10px;
            padding: 1.25rem;
            border: 1px solid #ddd;
            transition: box-shadow .2s;
            height: 100%;
        }

        .news-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .news-title {
            font-size: 1.05rem;
            font-weight: 700;
            margin-bottom: .6rem;
            color: #222;
        }

        .news-summary {
            color: #555;
            font-size: .9rem;
            white-space: pre-line;
            margin-bottom: 1rem;
        }

        .news-date {
            font-size: .8rem;
            color: #777;
        }
    </style>
</head>
<body>

<header>
    <h2>KHNP H₂ 뉴스 아카이브</h2>
    <p class="mb-0">매일 자동 업데이트되는 수소 에너지 뉴스</p>
</header>

<div class="container mb-5">

    <!-- 날짜 필터 -->
    <div class="row mb-3">
        <div class="col-md-4">
            <input type="date" id="dateFilter" class="form-control">
        </div>
        <div class="col-md-2">
            <button class="btn btn-primary w-100" onclick="applyFilter()">검색</button>
        </div>
        <div class="col-md-2">
            <button class="btn btn-secondary w-100" onclick="resetFilter()">전체보기</button>
        </div>
        <div class="col-md-4 text-end text-muted pt-2">
            마지막 업데이트: <span id="last-updated">-</span>
        </div>
    </div>

    <!-- 뉴스 카드 -->
    <div class="row g-4" id="news-container"></div>

    <div class="text-center text-muted mt-4" id="status-message"></div>
</div>

<script>
    let allArticles = [];

    // 날짜 형식 변환 YYYY-MM-DD → YYYY.MM.DD
    function formatDate(dateStr) {
        if (!dateStr) return "";
        return dateStr.replace(/-/g, ".");
    }

    function renderNews(list) {
        const container = document.getElementById("news-container");
        container.innerHTML = "";

        if (!list || list.length === 0) {
            container.innerHTML = `
                <div class="col-12 text-center text-muted py-5">
                    표시할 기사가 없습니다.
                </div>
            `;
            return;
        }

        let html = "";
        list.forEach(article => {
            html += `
                <div class="col-md-4">
                    <div class="news-card">
                        <div class="news-title">${article.title}</div>
                        <div class="news-summary">${article.summary || ""}</div>
                        <div class="d-flex justify-content-between">
                            <span class="news-date">${formatDate(article.date)}</span>
                            <a href="${article.url}" target="_blank" class="text-primary">원문보기</a>
                        </div>
                    </div>
                </div>
            `;
        });

        container.innerHTML = html;
    }

    function applyFilter() {
        const selected = document.getElementById("dateFilter").value;
        if (!selected) return;

        const filtered = allArticles.filter(a => a.date === selected);
        renderNews(filtered);
    }

    function resetFilter() {
        document.getElementById("dateFilter").value = "";
        renderNews(allArticles);
    }

    async function loadNews() {
        const status = document.getElementById("status-message");

        try {
            // 최신 JSON 우선
            let res = await fetch("data/latest.json", { cache: "no-store" });

            if (!res.ok) {
                // 날짜 JSON으로 fallback
                const today = new Date().toISOString().split("T")[0];
                res = await fetch(`data/${today}.json`, { cache: "no-store" });
            }

            if (!res.ok) {
                status.textContent = "크롤링된 뉴스 파일을 찾을 수 없습니다.";
                return;
            }

            const data = await res.json();
            allArticles = data;

            // 최근 날짜 표시
            if (data.length > 0) {
                const latestDate = data[0].date;
                document.getElementById("last-updated").textContent = latestDate;
            }

            renderNews(allArticles);

        } catch (err) {
            console.error(err);
            status.textContent = "데이터 로드 중 오류 발생.";
        }
    }

    document.addEventListener("DOMContentLoaded", loadNews);
</script>

</body>
</html>
