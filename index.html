<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>KHNP Hydrogen News</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Bootstrap for layout -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
    body {
        background: #f5f7fa;
        font-family: 'Segoe UI', Pretendard, sans-serif;
    }
    header {
        background: #0b3c78;
        color: white;
        padding: 1.5rem 0;
        text-align: center;
        margin-bottom: 2rem;
    }
    .news-card {
        background: white;
        padding: 1.2rem 1.4rem;
        border-radius: 12px;
        box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        transition: 0.2s;
        height: 100%;
    }
    .news-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 6px 18px rgba(0,0,0,0.15);
    }
    .tags span {
        display: inline-block;
        background: #e7f1ff;
        padding: 3px 8px;
        margin-right: 6px;
        margin-top: 4px;
        border-radius: 6px;
        color: #0b3c78;
        font-size: 0.75rem;
        cursor: pointer;
    }
    .filter-box {
        background: white;
        padding: 1rem 1.5rem;
        border-radius: 12px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        margin-bottom: 2rem;
    }
</style>

</head>
<body>

<header>
    <h2 class="fw-bold">KHNP Hydrogen News Archive</h2>
    <p class="mb-0">최신 수소 뉴스 아카이브 (자동 업데이트)</p>
</header>

<div class="container">

    <!-- 필터 박스 -->
    <div class="filter-box">

        <div class="row g-3">

            <!-- 날짜 선택 -->
            <div class="col-md-3">
                <label class="form-label fw-bold">날짜 선택</label>
                <select id="dateFilter" class="form-select">
                    <option value="all">전체 날짜</option>
                </select>
            </div>

            <!-- 태그 선택 -->
            <div class="col-md-3">
                <label class="form-label fw-bold">태그 필터</label>
                <select id="tagFilter" class="form-select">
                    <option value="all">전체 태그</option>
                </select>
            </div>

            <!-- 검색 -->
            <div class="col-md-6">
                <label class="form-label fw-bold">검색</label>
                <input type="text" id="searchInput" class="form-control" placeholder="제목, 요약, 태그 검색...">
            </div>

        </div>
    </div>

    <!-- 뉴스 리스트 -->
    <div class="row" id="newsList"></div>

</div>

<script>
// -------------------------------
// JSON Load
// -------------------------------
let articles = [];
let filtered = [];

async function loadJSON() {
    const res = await fetch("data/latest.json?" + Date.now()); // 캐시방지
    articles = await res.json();

    // 날짜/태그 필터 옵션 자동 생성
    buildDateOptions();
    buildTagOptions();

    // 첫 렌더링
    filtered = [...articles];
    render();
}

// -------------------------------
// 날짜 필터 구성
// -------------------------------
function buildDateOptions() {
    const dateSet = new Set(articles.map(a => a.date));
    const dateFilter = document.getElementById("dateFilter");

    dateSet.forEach(date => {
        let op = document.createElement("option");
        op.value = date;
        op.textContent = date;
        dateFilter.appendChild(op);
    });
}

// -------------------------------
// 태그 필터 구성
// -------------------------------
function buildTagOptions() {
    const tagSet = new Set();

    articles.forEach(a => {
        (a.tags || []).forEach(t => tagSet.add(t));
    });

    const tagFilter = document.getElementById("tagFilter");

    tagSet.forEach(tag => {
        let op = document.createElement("option");
        op.value = tag;
        op.textContent = tag;
        tagFilter.appendChild(op);
    });
}

// -------------------------------
// 렌더링
// -------------------------------
function render() {
    const container = document.getElementById("newsList");
    container.innerHTML = "";

    if (filtered.length === 0) {
        container.innerHTML = `<p class="text-center text-muted mt-5">검색된 기사가 없습니다.</p>`;
        return;
    }

    filtered.forEach(a => {
        container.innerHTML += `
            <div class="col-md-6 mb-4">
                <div class="news-card">
                    <h5 class="fw-bold mb-2">${a.title}</h5>
                    <div class="text-muted mb-2">${a.date} · ${a.source}</div>
                    <p class="mb-2">${a.subtitle}</p>

                    <div class="tags mb-2">
                        ${a.tags.map(t => `<span onclick="filterByTag('${t}')">${t}</span>`).join("")}
                    </div>

                    <a href="${a.url}" target="_blank" class="text-primary fw-bold">기사보기 →</a>
                </div>
            </div>
        `;
    });
}

// -------------------------------
// 필터 적용
// -------------------------------
function applyFilters() {
    const dateVal = document.getElementById("dateFilter").value;
    const tagVal = document.getElementById("tagFilter").value;
    const keyword = document.getElementById("searchInput").value.toLowerCase();

    filtered = articles.filter(a => {

        let ok = true;

        if (dateVal !== "all") ok = ok && a.date === dateVal;
        if (tagVal !== "all") ok = ok && a.tags.includes(tagVal);

        if (keyword) {
            const block = `${a.title} ${a.subtitle} ${a.tags.join(" ")}`.toLowerCase();
            ok = ok && block.includes(keyword);
        }

        return ok;
    });

    render();
}

// -------------------------------
// 태그 클릭해서 필터링
// -------------------------------
function filterByTag(tag) {
    document.getElementById("tagFilter").value = tag;
    applyFilters();
}

// -------------------------------
// 이벤트 연결
// -------------------------------
document.getElementById("dateFilter").addEventListener("change", applyFilters);
document.getElementById("tagFilter").addEventListener("change", applyFilters);
document.getElementById("searchInput").addEventListener("input", applyFilters);

// -------------------------------
loadJSON();
</script>

</body>
</html>
