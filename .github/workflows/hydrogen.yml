name: Daily Hydrogen News Crawler

on:
  workflow_dispatch:
  schedule:
    # =========================
    # KST ê¸°ì¤€ ìë™ ì‹¤í–‰
    # =========================
    # KST 08:00  â†’ UTC 23:00 (ì „ë‚ )
    - cron: "0 23 * * *"
    # KST 15:00  â†’ UTC 06:00
    - cron: "0 6 * * *"

# GitHub Pages / JSON ì»¤ë°‹ì„ ìœ„í•œ ê¶Œí•œ
permissions:
  contents: write

jobs:
  crawler:
    runs-on: ubuntu-latest

    steps:
      # 1ï¸âƒ£ ì €ì¥ì†Œ ì²´í¬ì•„ì›ƒ
      - name: Checkout repo
        uses: actions/checkout@v4

      # 2ï¸âƒ£ Python ì„¸íŒ…
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      # 3ï¸âƒ£ ì˜ì¡´ì„± ì„¤ì¹˜
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests beautifulsoup4

      # 4ï¸âƒ£ í¬ë¡¤ëŸ¬ ì‹¤í–‰
      - name: Run crawler
        env:
          GITHUB_ACTIONS: "true"
        run: |
          echo "=================================="
          echo "ğŸ•’ ì‹¤í–‰ ì‹œê° (UTC)"
          date -u
          echo "ğŸ•’ ì‹¤í–‰ ì‹œê° (KST)"
          TZ=Asia/Seoul date
          echo "=================================="

          echo "ğŸ“‚ í˜„ì¬ ë””ë ‰í† ë¦¬"
          ls

          echo "ğŸ“‚ data ë””ë ‰í† ë¦¬ (before)"
          ls -R data || echo "data í´ë” ì—†ìŒ"

          echo "ğŸš€ ë‰´ìŠ¤ í¬ë¡¤ëŸ¬ ì‹¤í–‰"
          python data/crawler/news_crawler.py

          echo "ğŸ“‚ data ë””ë ‰í† ë¦¬ (after)"
          ls -R data

      # 5ï¸âƒ£ ë³€ê²½ì‚¬í•­ ì»¤ë°‹ & í‘¸ì‹œ
      - name: Commit & Push
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

          git add data
          git status

          # ë³€ê²½ ìˆì„ ë•Œë§Œ ì»¤ë°‹ (ì¤‘ë³µ ì‹¤í–‰ ì•ˆì „)
          git commit -m "Daily hydrogen news update" || echo "No changes to commit"

          git push
