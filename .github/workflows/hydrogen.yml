name: Daily Hydrogen News Crawler

on:
  workflow_dispatch:
  schedule:
    # =========================
    # KST ê¸°ì¤€ ìë™ ì‹¤í–‰
    # =========================

    # ğŸ”¹ ë§¤ì¼ ë‰´ìŠ¤ í¬ë¡¤ë§
    # KST 08:00 â†’ UTC 23:00 (ì „ë‚ )
    - cron: "0 23 * * *"

    # KST 15:00 â†’ UTC 06:00
    - cron: "0 6 * * *"

    # ğŸ”¹ ì£¼ê°„ ë¯¸ë‹ˆ ë¦¬í¬íŠ¸
    # KST ê¸ˆìš”ì¼ 15:20 â†’ UTC ê¸ˆìš”ì¼ 06:20
    - cron: "20 6 * * 5"

permissions:
  contents: write

jobs:
  crawler:
    runs-on: ubuntu-latest

    steps:
      # 1ï¸âƒ£ ì €ì¥ì†Œ ì²´í¬ì•„ì›ƒ
      - name: Checkout repo
        uses: actions/checkout@v4

      # 2ï¸âƒ£ Python ì„¸íŒ…
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      # 3ï¸âƒ£ ì˜ì¡´ì„± ì„¤ì¹˜
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests beautifulsoup4

      # 4ï¸âƒ£ ì¼ê°„ ë‰´ìŠ¤ í¬ë¡¤ëŸ¬ ì‹¤í–‰
      - name: Run daily crawler
        run: |
          echo "=================================="
          echo "ğŸ•’ ì‹¤í–‰ ì‹œê° (UTC)"
          date -u
          echo "ğŸ•’ ì‹¤í–‰ ì‹œê° (KST)"
          TZ=Asia/Seoul date
          echo "=================================="

          python data/crawler/news_crawler.py

      # 5ï¸âƒ£ ì£¼ê°„ ë¯¸ë‹ˆ ë¦¬í¬íŠ¸ ìƒì„± (ê¸ˆìš”ì¼ 15:20 KST ì „ìš©)
      - name: Build weekly mini report
        if: ${{ github.event_name == 'schedule' && github.event.schedule == '20 6 * * 5' }}
        run: |
          echo "ğŸ“Š ì£¼ê°„ íŠ¸ë Œë“œ ë¯¸ë‹ˆ ë¦¬í¬íŠ¸ ìƒì„±"
          python data/crawler/make_weekly.py

      # 6ï¸âƒ£ ë³€ê²½ì‚¬í•­ ì»¤ë°‹ & í‘¸ì‹œ
      - name: Commit & Push
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

          git add data
          git status

          git commit -m "Auto update (daily news / weekly report)" || echo "No changes to commit"
          git push
